<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="kbtbr">
<title>Advanced: The KoboClient class â€¢ kbtbr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced: The KoboClient class">
<meta property="og:description" content="kbtbr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">kbtbr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/kbtbr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/wrangling-survey-responses.html">Data wrangling of responses</a>
    <a class="dropdown-item" href="../articles/koboclient-class.html">Advanced: The KoboClient class</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/CorrelAid/kbtbr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="koboclient-class_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Advanced: The KoboClient class</h1>
            
            <h4 data-toc-skip class="date">2022-02-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/CorrelAid/kbtbr/blob/HEAD/vignettes/koboclient-class.Rmd" class="external-link"><code>vignettes/koboclient-class.Rmd</code></a></small>
      <div class="d-none name"><code>koboclient-class.Rmd</code></div>
    </div>

    
    
<pre><code><span class="co">## NULL</span></code></pre>
<p><code>KoboClient</code> is an R6 class that manages the connection between R and the server that hosts the KoboToolbox. Most users should not need the <code>KoboClient</code> class because <code>Kobo</code> takes care of the end-user services. <code>Kobo</code> uses <code>KoboClient</code> under the hood.</p>
<p><code>KoboClient</code> is effectively an HTTP client and inherits its features from the <a href="https://github.com/ropensci/crul" class="external-link">crul</a> library, in particular from <code><a href="https://docs.ropensci.org/crul/reference/HttpClient.html" class="external-link">crul::HttpClient</a></code>.</p>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<div class="section level3">
<h3 id="initialization">Initialization<a class="anchor" aria-label="anchor" href="#initialization"></a>
</h3>
<p>To start a session, one needs to know the URL to the KoboToolbox server and the API token, a unique key that allows interaction with the Kobo server. You can get the API key in your account settings.</p>
<p>One possibility is to store the token as an environment variable. The <code>KoboClient</code> will check if the variable <code>KBTBR_TOKEN</code> is set during the initialization. Otherwise, one can pass the token to the initialization function.</p>
<p>The first step to start a session is to create an object from the R6 class by calling the <code>$new</code> method.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CorrelAid/kbtbr/" class="external-link">kbtbr</a></span><span class="op">)</span>
<span class="va">base_url</span> <span class="op">&lt;-</span> <span class="st">"https://kobo.correlaid.org"</span>
<span class="va">my_session</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/KoboClient.html">KoboClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">base_url</span>, kobo_token <span class="op">=</span> <span class="st">"faketoken"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">my_session</span><span class="op">)</span>
<span class="co">#&gt; [1] "KoboClient" "HttpClient" "R6"</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-power-of-inheritance">The power of inheritance<a class="anchor" aria-label="anchor" href="#the-power-of-inheritance"></a>
</h3>
<p>Thanks to the inheritance mechanism, <code>my_session</code> can provide all the features of <a href="https://docs.ropensci.org/crul/reference/HttpClient.html" class="external-link"><code>crul::HttpClient</code></a> that is the parent R6 class.</p>
<p>For example,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_session</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; &lt;crul connection&gt; </span>
<span class="co">#&gt;   url: https://kobo.correlaid.org</span>
<span class="co">#&gt;   curl options: </span>
<span class="co">#&gt;   proxies: </span>
<span class="co">#&gt;   auth: </span>
<span class="co">#&gt;   headers: </span>
<span class="co">#&gt;     Authorization: Token faketoken</span>
<span class="co">#&gt;     Accept: application/json</span>
<span class="co">#&gt;   progress: FALSE</span>
<span class="co">#&gt;   hooks:</span></code></pre></div>
<p>will show you several properties set in the HTTP client, like the headers, the URL and other properties. The <code>$print()</code> method is not implemented in the KoboClient class, but it is automatically inherited from its parent class.</p>
<p>KoboClient is called a child of <code><a href="https://docs.ropensci.org/crul/reference/HttpClient.html" class="external-link">crul::HttpClient</a></code>, the parent, and by the inheritance mechanism can have all of its features (methods and fields) of the parent, but it can also provide more features or specialize some of the parent methods. In our case, for example, some features are added to work effectively with the KoboToolbox API: it stores the API token as private variable, or some method are further specialized like the <code>$get</code> method described in the next section.</p>
</div>
<div class="section level3">
<h3 id="get-method">
<code>get</code> Method<a class="anchor" aria-label="anchor" href="#get-method"></a>
</h3>
<p>The get method is based on the method <a href="https://docs.ropensci.org/crul/reference/HttpClient.html#method-get" class="external-link"><code>$get()</code></a> of the parent class. Hence, the <code>get</code> method will query the APIs and return an R6 object of class <code><a href="https://docs.ropensci.org/crul/reference/HttpResponse.html" class="external-link">crul::HttpResponse</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assets</span> <span class="op">&lt;-</span> <span class="va">my_session</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"api/v2/assets/"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">assets</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; Classes 'HttpResponse', 'R6' &lt;HttpResponse&gt;</span>
<span class="co">#&gt;   Public:</span>
<span class="co">#&gt;     clone: function (deep = FALSE) </span>
<span class="co">#&gt;     content: 7b 22 63 6f 75 6e 74 22 3a 36 35 2c 22 6e 65 78 74 22 3a ...</span>
<span class="co">#&gt;     handle: NULL</span>
<span class="co">#&gt;     initialize: function (method, url, opts, handle, status_code, request_headers, </span>
<span class="co">#&gt;     method: get</span>
<span class="co">#&gt;     modified: NA</span>
<span class="co">#&gt;     opts: NULL</span>
<span class="co">#&gt;     parse: function (encoding = NULL, ...) </span>
<span class="co">#&gt;     print: function (x, ...) </span>
<span class="co">#&gt;     raise_for_ct: function (type, charset = NULL, behavior = "stop") </span>
<span class="co">#&gt;     raise_for_ct_html: function (charset = NULL, behavior = "stop") </span>
<span class="co">#&gt;     raise_for_ct_json: function (charset = NULL, behavior = "stop") </span>
<span class="co">#&gt;     raise_for_ct_xml: function (charset = NULL, behavior = "stop") </span>
<span class="co">#&gt;     raise_for_status: function () </span>
<span class="co">#&gt;     request: RequestSignature, R6</span>
<span class="co">#&gt;     request_headers: list</span>
<span class="co">#&gt;     response_headers: list</span>
<span class="co">#&gt;     response_headers_all: list</span>
<span class="co">#&gt;     status_code: 200</span>
<span class="co">#&gt;     status_http: function (verbose = FALSE) </span>
<span class="co">#&gt;     success: function () </span>
<span class="co">#&gt;     times: NULL</span>
<span class="co">#&gt;     url: https://kobo.correlaid.org/api/v2/assets/?format=json</span>
<span class="co">#&gt;   Private:</span>
<span class="co">#&gt;     raise_for_ct_factory: function (type) </span>
<span class="co">#&gt;     raise_for_ct_user: function ()</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="the-use-of-koboclient-in-the-kobo-class">The use of KoboClient in the Kobo class<a class="anchor" aria-label="anchor" href="#the-use-of-koboclient-in-the-kobo-class"></a>
</h2>
<p>The <code>Kobo</code> class uses <code>KoboClient</code> for its HTTP requests. Kobo can create a session by initializing a <code>KoboClient</code> instance itself based on <code>base_url_v2</code>. This is probably the easiest way to initialize a <code>Kobo</code> instance.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">kobo</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Kobo.html">Kobo</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">base_url</span><span class="op">)</span></code></pre></div>
<p>Alternatively, the user can pass a session - a <code>KoboClient</code> instance associated with an API base URL - via the <code>session_v2</code> argument of <code>Kobo$new()</code>. The Kobo instance will then use this session for all the communication with the servers.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># passing a KoboClient instance / a session to Kobo</span>
<span class="va">my_session</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/KoboClient.html">KoboClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">base_url</span><span class="op">)</span>
<span class="va">kobo</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Kobo.html">Kobo</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>session_v2 <span class="op">=</span> <span class="va">my_session</span><span class="op">)</span></code></pre></div>
<p>If the user specifies <code>base_url_v1</code> as an argument to <code>Kobo$new()</code> to make use of functionality based on KoBoToolbox API v1, the initializer of <code>Kobo</code> will initialize a second <code>KoboClient</code> instance to communicate with the v1 version of the API. The <code>Kobo</code> instance will then have two sessions, one for v2 and one for v1.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specifying session for API v2 directly, but letting Kobo initialize the one for API v1</span>
<span class="va">kobo</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Kobo.html">Kobo</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>session_v2 <span class="op">=</span> <span class="va">my_session</span>, base_url_v1 <span class="op">=</span> <span class="st">"kc.correlaid.org"</span><span class="op">)</span>
<span class="va">kobo</span>
<span class="co">#&gt; &lt;Kobo&gt;</span>
<span class="co">#&gt;   Public:</span>
<span class="co">#&gt;     clone: function (deep = FALSE) </span>
<span class="co">#&gt;     clone_asset: function (clone_from, new_name, asset_type) </span>
<span class="co">#&gt;     create_asset: function (name, asset_type, description = "", sector = list(label = "", </span>
<span class="co">#&gt;     deploy_asset: function (uid) </span>
<span class="co">#&gt;     get: function (path, query = list(), version = "v2", format = "json", </span>
<span class="co">#&gt;     get_asset: function (id) </span>
<span class="co">#&gt;     get_assets: function () </span>
<span class="co">#&gt;     get_submissions: function (id) </span>
<span class="co">#&gt;     get_surveys: function (show_all_cols = FALSE) </span>
<span class="co">#&gt;     import_xls_form: function (name, file_path) </span>
<span class="co">#&gt;     initialize: function (base_url_v2 = NULL, base_url_v1 = NULL, kobo_token = Sys.getenv("KBTBR_TOKEN"), </span>
<span class="co">#&gt;     post: function (path, body, version = "v2") </span>
<span class="co">#&gt;     session_v1: KoboClient, HttpClient, R6</span>
<span class="co">#&gt;     session_v2: KoboClient, HttpClient, R6</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assets</span> <span class="op">&lt;-</span> <span class="va">kobo</span><span class="op">$</span><span class="fu">get_assets</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">assets</span><span class="op">)</span>
<span class="co">#&gt;  [1] "url"                          "date_modified"               </span>
<span class="co">#&gt;  [3] "date_created"                 "owner"                       </span>
<span class="co">#&gt;  [5] "summary"                      "owner__username"             </span>
<span class="co">#&gt;  [7] "parent"                       "uid"                         </span>
<span class="co">#&gt;  [9] "tag_string"                   "settings"                    </span>
<span class="co">#&gt; [11] "kind"                         "name"                        </span>
<span class="co">#&gt; [13] "asset_type"                   "version_id"                  </span>
<span class="co">#&gt; [15] "has_deployment"               "deployed_version_id"         </span>
<span class="co">#&gt; [17] "deployment__identifier"       "deployment__active"          </span>
<span class="co">#&gt; [19] "deployment__submission_count" "permissions"                 </span>
<span class="co">#&gt; [21] "downloads"                    "data"</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Dimitri Marinelli, Lada Rudnitckaia, Malte Kyhos, Timm Hamm, Frie Preu.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
