<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The KoboClient class and how to use it • kbtbr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="The KoboClient class and how to use it">
<meta property="og:description" content="kbtbr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">kbtbr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.3000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/KoboClient_class.html">The KoboClient class and how to use it</a>
    </li>
    <li>
      <a href="../../articles/articles/response_overview.html">Response overview</a>
    </li>
    <li>
      <a href="../../articles/articles/using_crul.html">Using crul with KoboToolbox</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CorrelAid/kbtbr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="KoboClient_class_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>The KoboClient class and how to use it</h1>
            
            <h4 class="date">2021-10-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/CorrelAid/kbtbr/blob/master/vignettes/articles/KoboClient_class.Rmd"><code>vignettes/articles/KoboClient_class.Rmd</code></a></small>
      <div class="hidden name"><code>KoboClient_class.Rmd</code></div>

    </div>

    
    
<pre><code>## ℹ Loading kbtbr</code></pre>
<pre><code>## NULL</code></pre>
<p><code>KoboClient</code> is an R6 class that manages the connection between R and the server that hosts the KoboToolbox. Most users should not need the <code>KoboClient</code> class because <code>Kobo</code> takes care of the end-user services. <code>Kobo</code> uses <code>KoboClient</code> under the hood.</p>
<p><code>KoboClient</code> is effectively an HTTP client and inherits its features from the <a href="https://github.com/ropensci/crul">crul</a> library, in particular from <a href="https://docs.ropensci.org/crul/reference/HttpClient.html"><code>crul::HttpClient</code></a>.</p>
<div id="getting-started" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h1>
<div id="initialization" class="section level2">
<h2 class="hasAnchor">
<a href="#initialization" class="anchor"></a>Initialization</h2>
<p>To start a session, one needs to know the URL to the KoboToolbox server and the API token, a unique key that allows interaction with the Kobo server. You can get the API key in your account settings.</p>
<p>One possibility is to store the token as an environment variable. The <code>KoboClient</code> will check if the variable <code>KBTBR_TOKEN</code> is set during the initialization. Otherwise, one can pass the token to the initialization function.</p>
<p>The first step to start a session is to create an object from the R6 class by calling the <code>$new</code> method.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">base_url</span> <span class="op">&lt;-</span> <span class="st">"https://kobo.correlaid.org"</span>
<span class="va">my_session</span> <span class="op">&lt;-</span> <span class="va"><a href="../../reference/KoboClient.html">KoboClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">base_url</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">my_session</span><span class="op">)</span>
<span class="co">#&gt; [1] "KoboClient" "HttpClient" "R6"</span></code></pre></div>
</div>
<div id="the-power-of-inheritance" class="section level2">
<h2 class="hasAnchor">
<a href="#the-power-of-inheritance" class="anchor"></a>The power of inheritance</h2>
<p>Thanks to the inheritance mechanism, <code>my_session</code> can provide all the features of <a href="https://docs.ropensci.org/crul/reference/HttpClient.html"><code>crul::HttpClient</code></a> that is the parent R6 class.</p>
<p>For example,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_session</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>will show you several properties set in the HTTP client, like the headers, the URL and other properties. The <code>$print()</code> method is not implemented in the KoboClient class, but it is automatically inherited from its parent class.</p>
<p>KoboClient is called a child of <a href="https://docs.ropensci.org/crul/reference/HttpClient.html"><code>crul::HttpClient</code></a>, the parent, and by the inheritance mechanism can have all of its features (methods and fields) of the parent, but it can also provide more features or specialize some of the parent methods. In our case, for example, some features are added to work effectively with the KoboToolbox API: it stores the API token as private variable, or some method are further specialized like the <code>$get</code> method described in the next section.</p>
</div>
<div id="get-method" class="section level2">
<h2 class="hasAnchor">
<a href="#get-method" class="anchor"></a><code>get</code> Method</h2>
<p>The get method is based on the method <a href="https://docs.ropensci.org/crul/reference/HttpClient.html#method-get"><code>$get()</code></a> of the parent class. The get method will query the APIs and return an R6 object of class <code><a href="https://docs.ropensci.org/crul/reference/HttpClient.html">crul::HttpClient</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assets</span> <span class="op">&lt;-</span> <span class="va">my_session</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span>path <span class="op">=</span> <span class="st">"api/v2/assets/"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">assets</span>, max.level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; Classes 'HttpResponse', 'R6' &lt;HttpResponse&gt;</span>
<span class="co">#&gt;   Public:</span>
<span class="co">#&gt;     clone: function (deep = FALSE) </span>
<span class="co">#&gt;     content: 7b 22 63 6f 75 6e 74 22 3a 36 30 2c 22 6e 65 78 74 22 3a ...</span>
<span class="co">#&gt;     handle: NULL</span>
<span class="co">#&gt;     initialize: function (method, url, opts, handle, status_code, request_headers, </span>
<span class="co">#&gt;     method: get</span>
<span class="co">#&gt;     modified: NA</span>
<span class="co">#&gt;     opts: NULL</span>
<span class="co">#&gt;     parse: function (encoding = NULL, ...) </span>
<span class="co">#&gt;     print: function (x, ...) </span>
<span class="co">#&gt;     raise_for_ct: function (type, charset = NULL, behavior = "stop") </span>
<span class="co">#&gt;     raise_for_ct_html: function (charset = NULL, behavior = "stop") </span>
<span class="co">#&gt;     raise_for_ct_json: function (charset = NULL, behavior = "stop") </span>
<span class="co">#&gt;     raise_for_ct_xml: function (charset = NULL, behavior = "stop") </span>
<span class="co">#&gt;     raise_for_status: function () </span>
<span class="co">#&gt;     request: RequestSignature, R6</span>
<span class="co">#&gt;     request_headers: list</span>
<span class="co">#&gt;     response_headers: list</span>
<span class="co">#&gt;     response_headers_all: list</span>
<span class="co">#&gt;     status_code: 200</span>
<span class="co">#&gt;     status_http: function (verbose = FALSE) </span>
<span class="co">#&gt;     success: function () </span>
<span class="co">#&gt;     times: NULL</span>
<span class="co">#&gt;     url: https://kobo.correlaid.org/api/v2/assets/</span>
<span class="co">#&gt;   Private:</span>
<span class="co">#&gt;     raise_for_ct_factory: function (type) </span>
<span class="co">#&gt;     raise_for_ct_user: function ()</span></code></pre></div>
</div>
</div>
<div id="the-use-of-koboclient-in-the-kobo-interface" class="section level1">
<h1 class="hasAnchor">
<a href="#the-use-of-koboclient-in-the-kobo-interface" class="anchor"></a>The use of KoboClient in the Kobo interface</h1>
<p>The Kobo interface uses KoboClient for its HTTP requests. Kobo can create a session by initializing a KoboClient instance, or the user can pass a session, a KoboClient instance associated with an API base URL. Since the API_v2 base URL can be different from the API_v1 one, when the user provides the <code>base_url_v1</code>, the Kobo interface prepares a second KoboClient instance to communicate with the v1 version of the APIs.</p>
<p>The user can create their KoboClient instance and then pass it to the Kobo interface. The Kobo interface will use the session for all the communication with the servers.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_session</span> <span class="op">&lt;-</span> <span class="va"><a href="../../reference/KoboClient.html">KoboClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">base_url</span><span class="op">)</span>
<span class="va">kobo</span> <span class="op">&lt;-</span> <span class="va"><a href="../../reference/Kobo.html">Kobo</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>session_v2 <span class="op">=</span> <span class="va">my_session</span><span class="op">)</span>
<span class="co">#&gt; ℹ You have not passed base_url_v1. This means you cannot use the following functions:</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assets</span> <span class="op">&lt;-</span> <span class="va">kobo</span><span class="op">$</span><span class="fu">get_assets</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 × 22
#&gt;   url   date_modified date_created owner summary$geo $labels $columns $languages
#&gt;   &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;        &lt;chr&gt; &lt;lgl&gt;       &lt;list&gt;  &lt;list&gt;   &lt;list&gt;    
#&gt; 1 http… 2021-09-24T1… 2021-05-02T… http… TRUE        &lt;chr [… &lt;chr [8… &lt;lgl [1]&gt; 
#&gt; 2 http… 2021-08-23T0… 2021-08-23T… http… NA          &lt;NULL&gt;  &lt;NULL&gt;   &lt;NULL&gt;    
#&gt; 3 http… 2021-08-10T1… 2021-08-10T… http… NA          &lt;NULL&gt;  &lt;NULL&gt;   &lt;NULL&gt;    
#&gt; 4 http… 2021-08-10T1… 2021-08-10T… http… NA          &lt;NULL&gt;  &lt;NULL&gt;   &lt;NULL&gt;    
#&gt; 5 http… 2021-08-10T1… 2021-08-10T… http… NA          &lt;NULL&gt;  &lt;NULL&gt;   &lt;NULL&gt;    
#&gt; 6 http… 2021-08-10T1… 2021-08-10T… http… NA          &lt;NULL&gt;  &lt;NULL&gt;   &lt;NULL&gt;    
#&gt; # … with 17 more variables: owner__username &lt;chr&gt;, parent &lt;chr&gt;, uid &lt;chr&gt;,
#&gt; #   tag_string &lt;chr&gt;, settings &lt;df[,4]&gt;, kind &lt;chr&gt;, name &lt;chr&gt;,
#&gt; #   asset_type &lt;chr&gt;, version_id &lt;chr&gt;, has_deployment &lt;lgl&gt;,
#&gt; #   deployed_version_id &lt;chr&gt;, deployment__identifier &lt;chr&gt;,
#&gt; #   deployment__active &lt;lgl&gt;, deployment__submission_count &lt;int&gt;,
#&gt; #   permissions &lt;list&gt;, downloads &lt;list&gt;, data &lt;chr&gt;</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Dimitri Marinelli, Lada Rudnitckaia, Malte Kyhos, Timm Hamm, Frie Preu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
