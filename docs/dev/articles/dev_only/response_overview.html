<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="kbtbr">
<title>Overview over different API endpoints • kbtbr</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Overview over different API endpoints">
<meta property="og:description" content="kbtbr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">kbtbr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../articles/kbtbr.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../../articles/wrangling-survey-responses.html">Data wrangling of responses</a>
    <a class="dropdown-item" href="../../articles/koboclient-class.html">Advanced: The KoboClient class</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/CorrelAid/kbtbr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="response_overview_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Overview over different API endpoints</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CorrelAid/kbtbr/blob/HEAD/vignettes/dev_only/response_overview.Rmd" class="external-link"><code>vignettes/dev_only/response_overview.Rmd</code></a></small>
      <div class="d-none name"><code>response_overview.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">base_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"KBTBR_BASE_URL"</span><span class="op">)</span>
<span class="va">token</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"KBTBR_TOKEN"</span><span class="op">)</span>

<span class="va">kobo</span> <span class="op">&lt;-</span> <span class="va"><a href="../../reference/Kobo.html">Kobo</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">base_url</span>, <span class="va">token</span><span class="op">)</span>
<span class="va">assets</span> <span class="op">&lt;-</span> <span class="va">kobo</span><span class="op">$</span><span class="fu">get_assets</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">results</span></code></pre></div>
<div class="section level2">
<h2 id="general-notes-and-setup">General notes and setup<a class="anchor" aria-label="anchor" href="#general-notes-and-setup"></a>
</h2>
<p><code>url</code> and <code>data</code> URLs contain almost all of the relevant information. They are accessible in the assets data frame as variables <code>url</code> and <code>data</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assets</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">url</span>, <span class="va">data</span><span class="op">)</span></code></pre></div>
<p><strong>(Download) links</strong>: In general, (download) links that are returned in the JSON responses seem to be mostly broken / resulting in <code>404</code> because almost always <code>?format=json</code> is appended to the URL. This can be also seen when we compare the links from <a href="https://kobo.correlaid.org/api/v2/assets/" class="external-link">the browser view of the assets list</a> with the data we get when making a <code>GET</code> request with <code>format=json</code> query.</p>
<p>Luckily, we can reconstruct those URLs easily with the <code>uid</code> of an asset and additional information.</p>
<p>To get some test elements, get an element of each asset type:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test_elements</span> <span class="op">&lt;-</span> <span class="va">assets</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">asset_type</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">deployment__submission_count</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="co"># reverse sort by submissions to get a survey with submissions</span>
  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">test_elements</span><span class="op">$</span><span class="va">asset_type</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="use-cases">Use cases<a class="anchor" aria-label="anchor" href="#use-cases"></a>
</h2>
<div class="section level3">
<h3 id="get-general-information-about-an-asset">Get general information about an asset<a class="anchor" aria-label="anchor" href="#get-general-information-about-an-asset"></a>
</h3>
<p>Get the name of an asset from the list of assets:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assets</span><span class="op">$</span><span class="va">name</span></code></pre></div>
<p>Get the uid of an asset from the list of assets:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assets</span><span class="op">$</span><span class="va">uid</span></code></pre></div>
<p>Additional information to the assets:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">assets</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-responses-to-a-survey">Get responses to a survey<a class="anchor" aria-label="anchor" href="#get-responses-to-a-survey"></a>
</h3>
<p>We can get the submissions to a survey with the <code>data</code> url (also accessible via the assets data frame). Conveniently, they already are parsed as a data frame in the <code>results</code> of the response:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submissions</span> <span class="op">&lt;-</span> <span class="va">test_elements</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">asset_type</span> <span class="op">==</span> <span class="st">"survey"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">removeBaseUrl</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span>
  <span class="va">kobo</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="op">)</span>
<span class="va">submissions</span><span class="op">$</span><span class="va">results</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-permissions-of-an-asset">Get permissions of an asset<a class="anchor" aria-label="anchor" href="#get-permissions-of-an-asset"></a>
</h3>
<p>All asset types have permissions as a data frame, one row per user and permission granted.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test_elements</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">asset_type</span> <span class="op">==</span> <span class="st">"survey"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">permissions</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-form-metadata-xlsform">Get form metadata / XLSForm<a class="anchor" aria-label="anchor" href="#get-form-metadata-xlsform"></a>
</h3>
<p>Metadata about the structure of forms, questions, templates and blocks can be found in the <code>content</code> element of the response to the <code>url</code> URL. For example for a survey:</p>
<div class="section level4">
<h4 id="content">
<code>content</code><a class="anchor" aria-label="anchor" href="#content"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">survey_url_data</span> <span class="op">&lt;-</span> <span class="va">test_elements</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">asset_type</span> <span class="op">==</span> <span class="st">"survey"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">removeBaseUrl</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="va">kobo</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">survey_url_data</span><span class="op">$</span><span class="va">content</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>This contains a list representation of an XLSForm, with the two <a href="https://xlsform.org/en/#basic-format" class="external-link">main Excel sheets <code>survey</code> and <code>choices</code></a> being nested in the list as data frames. Some additional variables exist that are Kobo-unique are prefixed with a <code>$</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">survey_url_data</span><span class="op">$</span><span class="va">content</span><span class="op">$</span><span class="va">survey</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">survey_url_data</span><span class="op">$</span><span class="va">content</span><span class="op">$</span><span class="va">choices</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="summary">
<code>summary</code><a class="anchor" aria-label="anchor" href="#summary"></a>
</h4>
<p>Potentially also relevant is the <code>summary</code> element.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">survey_url_data</span><span class="op">$</span><span class="va">summary</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="xml">xml<a class="anchor" aria-label="anchor" href="#xml"></a>
</h4>
<p>To get the xlsform as a <code>xml</code> we could use <code>assets/{uid}/xmlform/</code> which currently does not work because we do not have the correct HTTP headers / cannot stream the content yet. It might not be worthwhile to implement this.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># kobo$get(glue::glue("assets/{survey_url_data$uid}/xform/"), query = list())</span></code></pre></div>
<p>This corresponds to the “fixed” version of:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">survey_url_data</span><span class="op">$</span><span class="va">xform_link</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="xls-in-browser">“xls” in browser??<a class="anchor" aria-label="anchor" href="#xls-in-browser"></a>
</h4>
<p>something similar also exists at <code>assets/{uid}/xls/</code>, e.g. <a href="https://kobo.correlaid.org/api/v2/assets/aRo4wg5utWT7dwdnQQEAE7/xls/" class="external-link uri">https://kobo.correlaid.org/api/v2/assets/aRo4wg5utWT7dwdnQQEAE7/xls/</a></p>
<p>corresponding to the fixed version of:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">survey_url_data</span><span class="op">$</span><span class="va">xls_link</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="file-downloads">File Downloads<a class="anchor" aria-label="anchor" href="#file-downloads"></a>
</h3>
<div class="section level4">
<h4 id="xlsform">XLSForm<a class="anchor" aria-label="anchor" href="#xlsform"></a>
</h4>
<p>To download the XLSForm as a file, we can use either: - <code>assets/{uid}.xls</code> (xls) - <code>assets/{uid}.xml</code> (xml)</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">uid</span> <span class="op">&lt;-</span> <span class="va">survey_url_data</span><span class="op">$</span><span class="va">uid</span>
<span class="va">kc</span> <span class="op">&lt;-</span> <span class="va"><a href="../../reference/KoboClient.html">KoboClient</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">base_url</span><span class="op">)</span>
<span class="co"># AT some point this worked?! </span>
<span class="co"># kc$get(glue::glue("api/v2/assets/{uid}.xls"), query = list(), disk = "xls_form_downloaded.xls")</span>
<span class="co"># </span>
<span class="co"># kc$get(glue::glue("api/v2/assets/{uid}.xml"), query = list(), disk = "xls_form_downloaded.xml")</span>
<span class="co"># we could also use the uid as the filename of course!</span></code></pre></div>
<p>Those urls correspond to the fixed versions of:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">survey_url_data</span><span class="op">$</span><span class="va">downloads</span><span class="op">$</span><span class="va">url</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="exports">Exports<a class="anchor" aria-label="anchor" href="#exports"></a>
</h4>
<p>we can also download exports that have been created in the UI (or via the API?) from <code>https://kobo.correlaid.org/exports/</code></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">exports</span> <span class="op">&lt;-</span> <span class="va">kc</span><span class="op">$</span>
  <span class="fu">get</span><span class="op">(</span><span class="st">"exports"</span><span class="op">)</span>
<span class="va">exports</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">data</span> <span class="co"># metadata about the export</span>
<span class="va">exports</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">source</span> <span class="co"># the asset the export was made of</span>

<span class="co"># download link</span>
<span class="va">exports</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">result</span>
<span class="co"># TODO: also make it possible to pass direct link and/or </span>
<span class="co"># remove the base_url</span>
<span class="co"># kc$get("private-media/api_user/exports/kbtbr_test_survey_applications_-_all_versions_-_English_en_-_2021-04-28-20-00-36.xlsx", disk = "export_downloaded.xls")</span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="overview-comparison">Overview / Comparison<a class="anchor" aria-label="anchor" href="#overview-comparison"></a>
</h2>
<p>This section compares the three main endpoints of interest across the four main asset types <code>survey</code>, <code>template</code>, <code>block</code> and <code>question</code>.</p>
<p>The three endpoints are: - <code>assets</code>: general “list” endpoint - <code>url</code>: exists for each asset, provides more detailed information than the list entry for the asset in <code>assets</code> - <code>data</code>: holds data related to the asset, seems to be only relevant for the asset type <code>survey</code> as it holds the survey submissions</p>
<div class="section level3">
<h3 id="data-from-the-url-url">Data from the <code>url</code> url<a class="anchor" aria-label="anchor" href="#data-from-the-url-url"></a>
</h3>
<p>First, we <code>GET</code> the data from the <code>url</code> URL for each of the “test” objects.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># data from "url" url</span>
<span class="va">url_data</span> <span class="op">&lt;-</span> <span class="va">test_elements</span><span class="op">$</span><span class="va">url</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">map</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">kobo</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu">removeBaseUrl</span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">set_names</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">test_elements</span><span class="op">$</span><span class="va">asset_type</span>, <span class="st">"_url"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We now build a table with columns <code>name</code> and <code>type</code> that hold the names of the list elements respectively the asset type. We also extract the column names of the assets data frame to compare them with the names of the list elements:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># extract the names of the assets data frame</span>
<span class="va">assets_names</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">assets</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"assets"</span><span class="op">)</span>
<span class="co"># extract the names from the object</span>
<span class="va">names_df</span> <span class="op">&lt;-</span> <span class="va">url_data</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">map_dfr</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">el</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">el</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"type"</span>, values_to <span class="op">=</span> <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">bind_rows</span><span class="op">(</span><span class="va">assets_names</span><span class="op">)</span> <span class="co"># combine with assets_df </span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">names_df</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/tabyl.html" class="external-link">tabyl</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">type</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span>   
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>All asset types have the same elements in their <code>url</code> return object. We also see that quite a lot of metadata seems to be already available in the assets data frame that we get from the <code>assets/</code> endpoint (cross-checking that the values are indeed the same would be beneficial - an attempt is made down below).</p>
</div>
<div class="section level3">
<h3 id="data-from-the-data-url">Data from the <code>data</code> url<a class="anchor" aria-label="anchor" href="#data-from-the-data-url"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_data</span> <span class="op">&lt;-</span> <span class="va">test_elements</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">map</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">url</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># "data" url seems to be 404 except for surveys, so try-catch it</span>
    <span class="co"># might also be different if we use questions, blocks, templates more seriously?</span>
    <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span>
      <span class="va">kobo</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu">removeBaseUrl</span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">results</span>,
      error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="va">e</span><span class="op">$</span><span class="va">message</span>
    <span class="op">)</span>
    <span class="va">tmp</span>
  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">set_names</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">test_elements</span><span class="op">$</span><span class="va">asset_type</span>, <span class="st">"data"</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">data_data</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>For the <code>data</code> url, we get a mixed pattern. For survey objects, the results contain the submissions to the survey as a data frame or an empty list if there are no submissions (<em>not</em> an empty data frame with the variables!). For the template and the block types, we get a 404, for the question type a 400 (bad request). This must be further investigated whether this is a bug of the CorrelAid server or as intended, e.g. by testing this on the official Kobo server. Most of the metadata for questions, templates and blocks is in the “content” element of the <code>url</code> data - see below - so it might be well that there is intentionally no “data” for this type.</p>
</div>
</div>
<div class="section level2">
<h2 id="in-depth-analysis">In depth analysis<a class="anchor" aria-label="anchor" href="#in-depth-analysis"></a>
</h2>
<p><strong>in bold</strong> are elements that seem to be particularly interesting for us and the construction of response classes.</p>
<div class="section level3">
<h3 id="asset-data-frame">Asset data frame<a class="anchor" aria-label="anchor" href="#asset-data-frame"></a>
</h3>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">assets</span><span class="op">)</span></code></pre></div>
<ul>
<li><strong><code>asset_type</code></strong></li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">assets</span><span class="op">$</span><span class="va">asset_type</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<strong><code>url</code></strong> and <strong><code>data</code></strong>: urls that’ll give us more information about the specific assets</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assets</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">url</span>, <span class="va">data</span><span class="op">)</span></code></pre></div>
<ul>
<li>general metadata:
<ul>
<li>
<strong><code>name</code></strong>: name of the asset</li>
<li>
<strong><code>owner</code></strong> and <strong><code>owner__username</code></strong>: the api url for the owner and the human-readable username</li>
</ul>
</li>
<li>
<strong><code>uid</code></strong>: the unique id of the asset, used in the urls.. but i suppose it doesn’t make a lot of sense to use this to construct urls ourselves given that they are always nicely handed to us by the API</li>
<li>
<code>settings</code>: sector, country where it was deployed, description given by the user</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">assets</span><span class="op">$</span><span class="va">settings</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">assets</span><span class="op">$</span><span class="va">settings</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>version</code> and <code>deployment*</code> columns: information about the version and the current deployment</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">assets</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">select</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"deployment"</span><span class="op">)</span>, <span class="va">version_id</span><span class="op">)</span></code></pre></div>
<ul>
<li>
<code>permissions</code>: permissions for this asset, one row per user and permission given.</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">assets</span><span class="op">$</span><span class="va">permissions</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="survey">Survey<a class="anchor" aria-label="anchor" href="#survey"></a>
</h3>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveyObject</span> <span class="op">&lt;-</span> <span class="va">url_data</span><span class="op">$</span><span class="va">survey_url</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">surveyObject</span><span class="op">)</span></code></pre></div>
<p>Here you have a more detailed overview with the elements of type character, <code>logical</code> and <code>numeric</code> displayed.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">surveyObject</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>Finally, all the sublists displayed separately in - roughly - decreasing order of interest, whereby the sublist <code>content</code> might be of particular interest.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveyObject</span><span class="op">$</span><span class="va">content</span>  </code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveyObject</span><span class="op">$</span><span class="va">settings</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveyObject</span><span class="op">$</span><span class="va">downloads</span> </code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveyObject</span><span class="op">$</span><span class="va">summary</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveyObject</span><span class="op">$</span><span class="va">deployment__links</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveyObject</span><span class="op">$</span><span class="va">permissions</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveyObject</span><span class="op">$</span><span class="va">deployed_versions</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveyObject</span><span class="op">$</span><span class="va">deployment__links</span> </code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveyObject</span><span class="op">$</span><span class="va">deployment__data_download_links</span> </code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#surveyObject$report_styles  # commented out because quite long but empty</span>
<span class="va">surveyObject</span><span class="op">$</span><span class="va">report_custom</span>  
<span class="va">surveyObject</span><span class="op">$</span><span class="va">map_styles</span> 
<span class="va">surveyObject</span><span class="op">$</span><span class="va">map_custom</span> </code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveyObject</span><span class="op">$</span><span class="va">embeds</span> </code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">surveyObject</span><span class="op">$</span><span class="va">assignable_permissions</span> </code></pre></div>
</div>
<div class="section level3">
<h3 id="question">Question<a class="anchor" aria-label="anchor" href="#question"></a>
</h3>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">question_url_data</span> <span class="op">&lt;-</span> <span class="va">url_data</span><span class="op">$</span><span class="va">question_url</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">question_url_data</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>The <code>content</code> list shows us more information / metadata about the question:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">question_url_data</span><span class="op">$</span><span class="va">content</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>This corresponds to the <code>survey</code> sheet of the question in XLSForm which we can check by comparing to the XLS downloadable here: <a href="https://kobo.correlaid.org/api/v2/assets/a7AV5JhRHKf8EWGBJLswwC.xls" class="external-link">https://kobo.correlaid.org/api/v2/assets/a7AV5JhRHKf8EWGBJLswwC.xls</a>.</p>
<p>The <code>start</code> and <code>end</code> rows are there because Kobo will by default always collect metadata about the start and end of the survey (cf <a href="https://xlsform.org/en/#metadata" class="external-link">XLSForm documentation</a>)</p>
</div>
<div class="section level3">
<h3 id="block">Block<a class="anchor" aria-label="anchor" href="#block"></a>
</h3>
<p>Blocks work similar than questions, the most important information is in the <code>content</code> element.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">block_url_data</span> <span class="op">&lt;-</span> <span class="va">url_data</span><span class="op">$</span><span class="va">block_url</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">block_url_data</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">block_url_data</span><span class="op">$</span><span class="va">content</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>In this block, we can also see that translations are stored in the <code>label</code> column of the <code>choices</code> and <code>survey</code> data frame respectively.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">block_url_data</span><span class="op">$</span><span class="va">content</span><span class="op">$</span><span class="va">survey</span><span class="op">$</span><span class="va">label</span>
<span class="va">block_url_data</span><span class="op">$</span><span class="va">content</span><span class="op">$</span><span class="va">choices</span><span class="op">$</span><span class="va">label</span></code></pre></div>
<p>blocks can belong to a collection:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">block_url_data</span><span class="op">$</span><span class="va">parent</span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">block_url_data</span><span class="op">$</span><span class="va">ancestors</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="templates">Templates<a class="anchor" aria-label="anchor" href="#templates"></a>
</h3>
<p>Templates are combinations of work similar than questions, the most important information is in the <code>content</code> element.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">template_url_data</span> <span class="op">&lt;-</span> <span class="va">url_data</span><span class="op">$</span><span class="va">template_url</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">template_url_data</span><span class="op">$</span><span class="va">content</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">template_url_data</span><span class="op">$</span><span class="va">content</span><span class="op">$</span><span class="va">survey</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>templates can belong to a collection:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">template_url_data</span><span class="op">$</span><span class="va">parent</span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Dimitri Marinelli, Lada Rudnitckaia, Malte Kyhos, Timm Hamm, Frie Preu.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
